<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Reservation Dashboard</title>

  <style>
    :root{
      --bg:#f6f8fb; --card:#ffffff; --ink:#1f2937; --muted:#6b7280;
      --primary:#2563eb; --primary-ink:#fff;
      --ok:#16a34a; --warn:#f59e0b; --bad:#ef4444; --chip:#eef2ff;
      --border:#e5e7eb; --shadow:0 6px 18px rgba(31,41,55,0.06);
      --head:#1d4ed8;
    }

    body{ margin:0; background:var(--bg); font-family:ui-sans-serif,system-ui; color:var(--ink); }
    .wrap{ max-width:1200px; margin:auto; padding:30px 16px; }
    header{ display:flex; justify-content:space-between; align-items:center; margin-bottom:24px; }
    header h1{ font-size:26px; font-weight:700; margin:0; }
    .sub{ margin-top:4px; font-size:14px; color:var(--muted); }
    .toolbar{ display:flex; gap:10px; }
    .btn{ padding:10px 14px; border-radius:10px; border:1px solid var(--border); cursor:pointer; }
    .btn.primary{ background:var(--primary); color:white; border:none; }
    .cards{ display:grid; grid-template-columns:repeat(4,1fr); gap:16px; margin-bottom:22px; }
    .card{ background:white; border-radius:16px; padding:18px; border:1px solid var(--border); box-shadow:var(--shadow); }
    .card h3{ margin:0; font-size:13px; color:var(--muted); }
    .card p{ margin:0; font-size:28px; font-weight:800; }

    .filters{ display:flex; gap:14px; background:white; padding:14px; border-radius:14px; border:1px solid var(--border); margin-bottom:22px; }
    .filters input, .filters select{ height:38px; border-radius:10px; border:1px solid var(--border); padding:8px 12px; }

    .table-wrap{ border-radius:14px; background:white; border:1px solid var(--border); }
    table{ width:100%; border-collapse:collapse; }
    thead th{ padding:12px; background:var(--head); color:white; font-weight:600; font-size:13px; }
    tbody td{ padding:12px; border-top:1px solid var(--border); font-size:14px; }
    tbody tr:hover{ background:#f9fbff; }

    .chip{ padding:4px 10px; border-radius:20px; font-size:12px; font-weight:700; display:inline-block; }
    .confirmed{ background:#dcfce7; color:#166534; }
    .updated{ background:#fef9c3; color:#854d0e; }
    .cancelled{ background:#fee2e2; color:#b91c1c; }
    .archived{ background:#d1d5db; color:#4b5563; }

    /* Modal */
    .modal-backdrop{ position:fixed; inset:0; background:#0008; display:none; align-items:center; justify-content:center; z-index:100; }
    .modal{ background:white; width:600px; max-width:90vw; border-radius:16px; padding:16px; border:1px solid var(--border); }
    .modal header{ padding-bottom:12px; border-bottom:1px solid var(--border); }
    .modal footer{ padding-top:12px; display:flex; justify-content:flex-end; gap:10px; }
    .field{ margin-bottom:12px; }
    .field input, .field textarea{ width:100%; padding:10px; border-radius:10px; border:1px solid var(--border); }
  </style>
</head>


<body>
<div class="wrap">

  <header>
    <div>
      <h1>ðŸ¤– AI Reservation Dashboard</h1>
      <p class="sub">Manage bookings, analyze insights, and stay organized</p>
    </div>
    <div class="toolbar">
      <button class="btn primary" id="newBtn">+ New Reservation</button>
      <button class="btn" onclick="location.reload()">Refresh</button>
    </div>
  </header>

  <!-- KPI -->
  <div class="cards">
    <div class="card"><h3>Total</h3><p>{{ reservations|length }}</p></div>
    <div class="card"><h3>Confirmed</h3><p>{{ reservations|selectattr('status','equalto','confirmed')|list|length }}</p></div>
    <div class="card"><h3>Cancelled</h3><p>{{ reservations|selectattr('status','equalto','cancelled')|list|length }}</p></div>
    <div class="card"><h3>This Week</h3><p>{{ weekly_count }}</p></div>
  </div>


  <!-- TABLE -->
  <div class="table-wrap">
    <table>
      <thead>
      <tr>
        <th>Date</th><th>Time</th><th>Customer</th><th>Party</th><th>Table</th><th>Status</th>
      </tr>
      </thead>
      <tbody>

      {% for r in reservations %}
      {% set dt = (r.datetime or "").split('T') %}
      <tr>
        <td>{{ dt[0] }}</td>
        <td>{{ dt[1][:5] }}</td>
        <td>{{ r.customer_name }}</td>
        <td>{{ r.party_size }}</td>
        <td>{{ r.table_number }}</td>
        <td><span class="chip {{ r.status }}">{{ r.status }}</span></td>
      </tr>
      {% endfor %}

      </tbody>
    </table>
  </div>

</div> <!-- wrap -->

<!-- âœ… CREATE RESERVATION MODAL -->
<div class="modal-backdrop" id="newModal">
  <div class="modal">
    <header><h2>âž• New Reservation</h2></header>

    <div class="field"><input id="new_name" placeholder="Customer name"></div>
    <div class="field"><input id="new_party" type="number" placeholder="Party size"></div>
    <div class="field"><input id="new_dt" type="datetime-local"></div>
    <div class="field"><input id="new_table" placeholder="Table (optional)"></div>
    <div class="field"><textarea id="new_notes" placeholder="Notes (optional)"></textarea></div>

    <footer>
      <button class="btn" onclick="closeNew()">Cancel</button>
      <button class="btn primary" onclick="createReservation()">Create Reservation</button>
    </footer>
  </div>
</div>




<script>
// âœ… OPEN/CLOSE MODAL
document.getElementById("newBtn").onclick = () => {
  document.getElementById("newModal").style.display = "flex";
};
function closeNew() {
  document.getElementById("newModal").style.display = "none";
}


// âœ… FIXED CREATE RESERVATION
async function createReservation() {
  const payload = {
    customer_name: document.getElementById("new_name").value,
    party_size: Number(document.getElementById("new_party").value),
    datetime: document.getElementById("new_dt").value,
    table_number: document.getElementById("new_table").value,
    notes: document.getElementById("new_notes").value,
  };

  await fetch("/createReservation", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  });

  closeNew();
  location.reload();
}


// âœ… REALTIME WEBSOCKET LIVE REFRESH
(function(){
  try {
    const ws = new WebSocket(`${location.protocol === "https:" ? "wss" : "ws"}://${location.host}/ws`);
    ws.onmessage = () => location.reload();
  } catch(e) {}
})();
</script>

</body>
</html>
